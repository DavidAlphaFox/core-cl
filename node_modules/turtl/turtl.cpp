#include <node.h>
#include "nan.h"
#include "turtl.h"
#include "msg.h"

using namespace v8;

/**
 * Load and start our lisp app, synchronously.
 */
NAN_METHOD(start_lisp) {
	NanScope();
	init_messaging();
	turtl_init();
	NanReturnUndefined();
}

/**
 * End/shutdown lisp
 */
NAN_METHOD(stop_lisp) {
	NanScope();
	turtl_shutdown();
	NanReturnUndefined();
}

void RegisterModule(Handle<Object> exports)
{
	exports->Set(NanSymbol("start"),
			FunctionTemplate::New(start_lisp)->GetFunction());
	//exports->Set(NanSymbol("start_async"),
	//		FunctionTemplate::New(load_turtl_async)->GetFunction());
	exports->Set(NanSymbol("stop"),
			FunctionTemplate::New(stop_lisp)->GetFunction());
	exports->Set(NanSymbol("set_msg_callback"),
			FunctionTemplate::New(set_msg_callback)->GetFunction());
	exports->Set(NanSymbol("send_msg_lisp"),
			FunctionTemplate::New(send_msg_lisp)->GetFunction());
}

NODE_MODULE(turtl, RegisterModule);

