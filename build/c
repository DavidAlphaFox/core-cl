#!/bin/bash

if [ "$1" != "dll" ]; then
	BUILD=exe
fi

export PATH=/c/dev/MinGW/bin:$PATH:..
ECL=/c/usr/local/ecl
CC=gcc
ECL_CONFIG=$ECL/ecl-config
CFLAGS="-I${ECL} -L${ECL} `$ECL_CONFIG --cflags`"
LDFLAGS="`$ECL_CONFIG --ldflags`"

if [ "$BUILD" == "exe" ]; then
	$CC \
		-DEXE \
		$CFLAGS \
		-o ../turtl.exe \
		../src/main.c \
		$LDFLAGS \
 		|| { echo "Fail whale."; exit 1; }
	chmod 755 ../turtl.exe
else
	$CC \
		-static \
		-o ../turtl.dll \
		../src/main.c \
		-Wl,--output-def,turtldll.def,--out-implib,libturtldll.a \
		$CFLAGS \
		$LDFLAGS \
		|| { echo "Fail whale."; exit 1; }
fi

